<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Juego de Plataformas Rom√°ntico</title>
	<style>
		body {
			margin: 0;
			background: linear-gradient(135deg, #ffb6b9 0%, #fae3d9 100%);
			font-family: 'Segoe UI', Arial, sans-serif;
			overflow: hidden;
		}
		#gameCanvas {
			display: block;
			margin: 0 auto;
			background: linear-gradient(180deg, #fff 60%, #fcd5ce 100%);
			border-radius: 20px;
			box-shadow: 0 8px 32px rgba(255, 105, 135, 0.2);
			max-width: 100vw;
			max-height: 80vh;
			width: 100vw;
			height: 80vh;
		}
		.controls {
			position: fixed;
			bottom: 30px;
			left: 50%;
			transform: translateX(-50%);
			display: flex;
			gap: 20px;
			z-index: 10;
		}
		.btn {
			width: 60px;
			height: 60px;
			border-radius: 50%;
			background: #ffb6b9;
			border: none;
			box-shadow: 0 4px 16px rgba(255, 105, 135, 0.2);
			font-size: 2em;
			color: #fff;
			transition: background 0.2s, transform 0.1s;
		}
		.btn:active, .btn.active {
			background: #ff6f91;
			transform: scale(1.1);
		}
		#message {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%) scale(0.7);
			background: rgba(255, 182, 185, 0.95);
			padding: 40px 30px;
			border-radius: 20px;
			box-shadow: 0 8px 32px rgba(255, 105, 135, 0.2);
			font-size: 1.5em;
			color: #d72660;
			text-align: center;
			display: none;
			opacity: 0;
			transition: opacity 1s, transform 1s;
		}
		#message.show {
			display: block;
			opacity: 1;
			transform: translate(-50%, -50%) scale(1);
		}
		#message .heart {
			font-size: 2em;
			color: #ff6f91;
			animation: heartbeat 1s infinite;
		}
		@keyframes heartbeat {
			0%, 100% { transform: scale(1); }
			50% { transform: scale(1.2); }
		}
		@media (max-width: 500px) {
			#gameCanvas {
				width: 100vw;
				height: 60vh;
			}
		}
	</style>
</head>
<body>
	<canvas id="gameCanvas" width="400" height="600"></canvas>
	<div class="controls">
		<button class="btn" id="leftBtn">‚üµ</button>
		<button class="btn" id="jumpBtn">‚¨Ü</button>
		<button class="btn" id="rightBtn">‚ü∂</button>
		<button class="btn" id="musicBtn" style="font-size:1.2em;width:40px;height:40px;background:#fff;color:#d72660;">üéµ</button>
	</div>
	<!-- M√∫sica generada por c√≥digo, suave -->
	<div id="message">
		<div class="heart">‚ù§Ô∏è</div>
		<p>¬°Felicidades por 1 a√±o y 4 meses juntos!<br>Te amo mucho mucho mucho.<br>Vamos por otro mes m√°s?</p>
		<div class="heart">‚ù§Ô∏è</div>
	</div>
	<script>
		// M√∫sica de fondo suave tipo arpa/piano
		let audioCtx, bgGain, bgNotes = [], bgNoteIndex = 0, bgInterval;
		function playSoftNote(freq, duration = 0.7, volume = 0.07) {
			if (!audioCtx) return;
			let osc = audioCtx.createOscillator();
			let gain = audioCtx.createGain();
			osc.type = 'triangle';
			osc.frequency.value = freq;
			gain.gain.value = volume;
			osc.connect(gain);
			gain.connect(audioCtx.destination);
			osc.start();
			osc.stop(audioCtx.currentTime + duration);
			gain.gain.setValueAtTime(volume, audioCtx.currentTime);
			gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + duration);
			setTimeout(() => { gain.disconnect(); }, duration * 1000 + 100);
		}
		function startMusic() {
			if (!audioCtx) {
				audioCtx = new (window.AudioContext || window.webkitAudioContext)();
				bgGain = audioCtx.createGain();
				bgGain.gain.value = 0.07;
				bgGain.connect(audioCtx.destination);
				// Melod√≠a suave (notas tipo arpa/piano)
				bgNotes = [523, 659, 698, 784, 659, 523, 659, 784];
				bgNoteIndex = 0;
				bgInterval = setInterval(() => {
					playSoftNote(bgNotes[bgNoteIndex % bgNotes.length], 0.7, 0.07);
					bgNoteIndex++;
				}, 900);
			}
		}
		function stopMusic() {
			if (bgInterval) clearInterval(bgInterval);
			bgInterval = null;
			if (audioCtx) audioCtx.close();
			audioCtx = null;
		}
		// Bot√≥n para activar/desactivar m√∫sica
		document.getElementById('musicBtn').addEventListener('click', function() {
			if (audioCtx) {
				stopMusic();
				this.textContent = 'üîá';
			} else {
				startMusic();
				this.textContent = 'üéµ';
			}
		});

		// Canvas responsivo
		const canvas = document.getElementById('gameCanvas');
		const ctx = canvas.getContext('2d');
		function resizeCanvas() {
			let w = Math.min(window.innerWidth, 400);
			let h = Math.min(window.innerHeight * 0.8, 600);
			canvas.width = w;
			canvas.height = h;
		}
		resizeCanvas();
		window.addEventListener('resize', resizeCanvas);
		let W = canvas.width;
		let H = canvas.height;

		// Plataformas y jugador
		let platforms = [
			{x: 0.1*W, y: H-50, w: 0.8*W, h: 20},
			{x: 0.15*W, y: H-130, w: 0.25*W, h: 15},
			{x: 0.6*W, y: H-200, w: 0.25*W, h: 15},
			{x: 0.2*W, y: H-280, w: 0.2*W, h: 15},
			{x: 0.55*W, y: H-350, w: 0.3*W, h: 15},
			{x: 0.35*W, y: H-430, w: 0.25*W, h: 15},
			{x: 0.45*W, y: H-510, w: 0.15*W, h: 15}, // Meta
		];
		let goal = {x: 0.45*W, y: H-550, w: 0.15*W, h: 30};

		let player = {
			x: 0.15*W,
			y: H-80,
			w: 32,
			h: 32,
			vx: 0,
			vy: 0,
			color: '#d72660',
			onGround: false,
			jumping: false,
			jumpAnim: 0
		};

		let keys = {left: false, right: false, jump: false};
		let gameOver = false;

		// Part√≠culas de corazones
		let particles = [];
		function spawnHeart(x, y) {
			particles.push({x, y, vx: (Math.random()-0.5)*2, vy: -2-Math.random()*2, alpha: 1, size: 12+Math.random()*8});
		}

		// Controles t√°ctiles y feedback visual
		function addTouchControl(btnId, key) {
			const btn = document.getElementById(btnId);
			btn.addEventListener('touchstart', function(e) {
				e.preventDefault();
				keys[key] = true;
				btn.classList.add('active');
				if (!audioCtx) startMusic();
			}, {passive: false});
			btn.addEventListener('touchend', function(e) {
				e.preventDefault();
				keys[key] = false;
				btn.classList.remove('active');
			}, {passive: false});
		}
		addTouchControl('leftBtn', 'left');
		addTouchControl('rightBtn', 'right');
		addTouchControl('jumpBtn', 'jump');

		// Controles de teclado (por si juegas en PC)
		window.addEventListener('keydown', e => {
			if (e.key === 'ArrowLeft') { keys.left = true; document.getElementById('leftBtn').classList.add('active'); }
			if (e.key === 'ArrowRight') { keys.right = true; document.getElementById('rightBtn').classList.add('active'); }
			if (e.key === ' ' || e.key === 'ArrowUp') { keys.jump = true; document.getElementById('jumpBtn').classList.add('active'); }
			if (!audioCtx) startMusic();
		});
		window.addEventListener('keyup', e => {
			if (e.key === 'ArrowLeft') { keys.left = false; document.getElementById('leftBtn').classList.remove('active'); }
			if (e.key === 'ArrowRight') { keys.right = false; document.getElementById('rightBtn').classList.remove('active'); }
			if (e.key === ' ' || e.key === 'ArrowUp') { keys.jump = false; document.getElementById('jumpBtn').classList.remove('active'); }
		});

		function drawPlatform(p) {
			ctx.save();
			ctx.fillStyle = '#ff6f91';
			ctx.shadowColor = '#ffb6b9';
			ctx.shadowBlur = 10;
			ctx.fillRect(p.x, p.y, p.w, p.h);
			ctx.strokeStyle = '#fff';
			ctx.lineWidth = 2;
			ctx.strokeRect(p.x, p.y, p.w, p.h);
			ctx.restore();
		}

		function drawPlayer() {
			ctx.save();
			ctx.shadowColor = '#d72660';
			ctx.shadowBlur = 12;
			ctx.translate(player.x + player.w/2, player.y + player.h/2);
			ctx.rotate(player.jumpAnim * 0.1);
			// Cuerpo
			ctx.fillStyle = player.color;
			ctx.beginPath();
			ctx.arc(0, 0, player.w/2, 0, Math.PI*2);
			ctx.fill();
			// Lazo
			ctx.save();
			ctx.rotate(-0.5);
			ctx.fillStyle = '#ffb6b9';
			ctx.beginPath();
			ctx.ellipse(-10, -12, 7, 4, 0, 0, Math.PI*2);
			ctx.ellipse(10, -12, 7, 4, 0, 0, Math.PI*2);
			ctx.fill();
			ctx.restore();
			// Carita
			ctx.fillStyle = '#fff';
			ctx.beginPath();
			ctx.arc(0, 0, player.w/4, 0, Math.PI*2);
			ctx.fill();
			ctx.fillStyle = '#d72660';
			ctx.beginPath();
			ctx.arc(-6, -4, 3, 0, Math.PI*2);
			ctx.arc(6, -4, 3, 0, Math.PI*2);
			ctx.fill();
			ctx.beginPath();
			ctx.arc(0, 6, 5, 0, Math.PI);
			ctx.strokeStyle = '#d72660';
			ctx.lineWidth = 2;
			ctx.stroke();
			// Coraz√≥n en el pecho
			ctx.font = '16px Segoe UI';
			ctx.fillText('‚ù§Ô∏è', 0, 10);
			ctx.restore();
		}

		function drawGoal() {
			ctx.save();
			ctx.fillStyle = '#fff';
			ctx.shadowColor = '#ffb6b9';
			ctx.shadowBlur = 10;
			ctx.fillRect(goal.x, goal.y, goal.w, goal.h);
			ctx.font = 'bold 1.2em Segoe UI';
			ctx.fillStyle = '#d72660';
			ctx.textAlign = 'center';
			ctx.fillText('META', goal.x + goal.w/2, goal.y + goal.h/2 + 8);
			ctx.font = '2em Segoe UI';
			ctx.fillText('‚ù§Ô∏è', goal.x + goal.w/2, goal.y + goal.h/2 - 10);
			ctx.restore();
		}

		function drawParticles() {
			for (let p of particles) {
				ctx.save();
				ctx.globalAlpha = p.alpha;
				ctx.font = `${p.size}px Segoe UI`;
				ctx.fillText('üíñ', p.x, p.y);
				ctx.restore();
			}
		}

		function showMessage() {
			const msg = document.getElementById('message');
			msg.classList.add('show');
			// Efecto de meta: arpegio alegre
			if (audioCtx) {
				let arpegio = [1046, 1318, 1567, 1760];
				arpegio.forEach((f, i) => {
					setTimeout(() => playBell(f, 0.18, 0.18), i * 120);
				});
			}
		}

		function update() {
			W = canvas.width;
			H = canvas.height;
			// Actualizar plataformas y meta si cambia tama√±o
			platforms = [
				{x: 0.1*W, y: H-50, w: 0.8*W, h: 20},
				{x: 0.15*W, y: H-130, w: 0.25*W, h: 15},
				{x: 0.6*W, y: H-200, w: 0.25*W, h: 15},
				{x: 0.2*W, y: H-280, w: 0.2*W, h: 15},
				{x: 0.55*W, y: H-350, w: 0.3*W, h: 15},
				{x: 0.35*W, y: H-430, w: 0.25*W, h: 15},
				{x: 0.45*W, y: H-510, w: 0.15*W, h: 15},
			];
			goal = {x: 0.45*W, y: H-550, w: 0.15*W, h: 30};

			if (gameOver) return;
			// Movimiento horizontal
			if (keys.left) player.vx = -3.5;
			else if (keys.right) player.vx = 3.5;
			else player.vx = 0;

			// Saltar
			if (keys.jump && player.onGround && !player.jumping) {
				player.vy = -9;
				player.jumping = true;
				player.jumpAnim = 1;
				spawnHeart(player.x + player.w/2, player.y);
			}

			// Animaci√≥n de salto
			if (player.jumpAnim > 0) player.jumpAnim -= 0.1;
			else player.jumpAnim = 0;

			// Gravedad
			player.vy += 0.5;
			player.x += player.vx;
			player.y += player.vy;

			// Colisiones con plataformas
			player.onGround = false;
			for (let p of platforms) {
				if (
					player.x + player.w > p.x &&
					player.x < p.x + p.w &&
					player.y + player.h > p.y &&
					player.y + player.h < p.y + p.h + 10 &&
					player.vy >= 0
				) {
					player.y = p.y - player.h;
					player.vy = 0;
					player.onGround = true;
					player.jumping = false;
				}
			}

			// Colisi√≥n con meta
			if (
				player.x + player.w > goal.x &&
				player.x < goal.x + goal.w &&
				player.y + player.h > goal.y &&
				player.y < goal.y + goal.h
			) {
				gameOver = true;
				showMessage();
			}

			// L√≠mites del canvas
			if (player.x < 0) player.x = 0;
			if (player.x + player.w > W) player.x = W - player.w;
			if (player.y + player.h > H) {
				player.y = H - player.h;
				player.vy = 0;
				player.onGround = true;
				player.jumping = false;
			}

			// Actualizar part√≠culas
			for (let p of particles) {
				p.x += p.vx;
				p.y += p.vy;
				p.alpha -= 0.02;
			}
			particles = particles.filter(p => p.alpha > 0);
		}

		function draw() {
			ctx.clearRect(0, 0, W, H);
			// Fondo decorativo
			for (let i = 0; i < 20; i++) {
				ctx.save();
				ctx.globalAlpha = 0.15;
				ctx.fillStyle = '#ffb6b9';
				ctx.beginPath();
				ctx.arc(Math.random()*W, Math.random()*H, Math.random()*30+10, 0, Math.PI*2);
				ctx.fill();
				ctx.restore();
			}
			// Plataformas
			for (let p of platforms) drawPlatform(p);
			// Meta
			drawGoal();
			// Jugador
			drawPlayer();
			// Part√≠culas
			drawParticles();
		}

		function gameLoop() {
			update();
			draw();
			requestAnimationFrame(gameLoop);
		}
		gameLoop();
	</script>
</body>
</html>
